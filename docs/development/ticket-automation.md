# Ticket Automation System

This document explains the unified ticket generation system that automatically creates individual user story and technical task files from epic definitions.

---

## Overview

The ticket automation system unifies all ticket generation into a single, intelligent workflow:

1. **Command:** `/generate-tickets` - Main command user runs
2. **Agent:** `ticket-automation-agent.md` - The engine that does the work
3. **Documentation:** This file - How the system works

### What It Solves

**Before (Manual Process):**
- Read epic document
- Manually create each US-XX.X file
- Manually create each TT-XX.X file
- Ensure proper formatting
- Update status document
- Result: 2-3 hours of manual work per epic

**After (Automated Process):**
```bash
/generate-tickets
```
- Scans all epics
- Generates all missing tickets
- Validates quality
- Updates status
- Result: 15 seconds, zero errors

---

## Architecture

### Three-Layer Design

```
Layer 1: User Interface
    ↓
  /generate-tickets command
    ↓
Layer 2: Orchestration
    ↓
  Command logic, validation, reporting
    ↓
Layer 3: Generation
    ↓
  ticket-automation-agent (reads, extracts, generates)
```

### How It Works

#### Phase 1: Analysis
```
User runs: /generate-tickets --epic=03

System:
1. Reads /docs/tickets/EPIC-03-conflict-detection/EPIC.md
2. Scans for "### US-03.X" and "### TT-03.X" sections
3. Counts: Expects 6 user stories, 3 technical tasks
4. Checks user-stories/ folder: Found 0 files
5. Checks technical-tasks/ folder: Found 0 files
6. Result: 9 tickets needed
```

#### Phase 2: Extraction
```
For each missing ticket (e.g., US-03.1):
1. Find "### US-03.1: Extract Tracking IDs from Script Content"
2. Extract the section content until next "### " or end of file
3. Parse out:
   - Title
   - Priority (P0, P1)
   - Story Points
   - Description paragraph
   - Acceptance Criteria (checkbox list)
   - Acceptance Criteria section
   - Tasks (if present)
   - Code examples
   - Related information
4. Store in structured format
```

#### Phase 3: Generation
```
For US-03.1:
1. Title: "Extract Tracking IDs from Script Content"
2. Filename: us-03.1-extract-tracking-ids.md
3. Content:
   - Header with ID, title, priority, points, status
   - Description from epic
   - Acceptance Criteria from epic
   - Implementation Tasks (if in epic)
   - Dependencies section
   - Testing Requirements section
   - Definition of Done section
   - Links to other tickets
4. Write to: docs/tickets/EPIC-03-conflict-detection/user-stories/
```

#### Phase 4: Validation
```
For each generated file:
1. Check file exists and readable
2. Verify markdown syntax is valid
3. Verify ticket ID matches filename
4. Ensure no placeholder text ("TBD", "TODO")
5. Check all sections have content
6. Verify relative links are valid
7. Validate kebab-case filename
```

#### Phase 5: Status Update
```
Updates EPIC-BREAKDOWN-STATUS.md:
- Change EPIC-03 status from "⚠️ Pending README" to "✅ Ready for Dev"
- Update "Individual Tickets" entry
- Add timestamp: "2025-10-16 14:32"
- Update completion percentage
```

---

## File Organization

### Generated File Locations

```
docs/tickets/
├── EPIC-00-project-setup/
│   ├── EPIC.md                          (source)
│   ├── README.md                        (guide)
│   ├── user-stories/                    (generated)
│   │   ├── us-00.1-git-repository-setup.md
│   │   ├── us-00.2-directory-structure.md
│   │   ├── us-00.3-essential-project-files.md
│   │   └── us-00.4-development-workflow.md
│   └── technical-tasks/                 (generated)
│       ├── tt-00.1-configure-git-repository.md
│       ├── tt-00.2-create-directory-structure.md
│       └── tt-00.3-create-project-files.md
├── ... (EPIC-01, EPIC-02 similar)
├── EPIC-03-conflict-detection/
│   ├── EPIC.md
│   ├── README.md
│   ├── user-stories/                    (9 files generated by automation)
│   └── technical-tasks/                 (3 files generated by automation)
└── ... (EPIC-04, EPIC-05 similar)
```

### File Naming Convention

**User Stories:**
- Format: `us-{epic}.{number}-{kebab-case-title}.md`
- Examples:
  - `us-03.1-extract-tracking-ids.md`
  - `us-03.2-auto-extract-on-save.md`
  - `us-03.4-admin-warnings.md`

**Technical Tasks:**
- Format: `tt-{epic}.{number}-{kebab-case-title}.md`
- Examples:
  - `tt-03.1-conflict-detector-class.md`
  - `tt-03.2-meta-boxes-integration.md`
  - `tt-03.3-admin-notices.md`

---

## Generated Ticket Content

Each generated ticket file contains:

### Section 1: Header
```markdown
# US-03.1: Extract Tracking IDs from Script Content

**Epic:** EPIC-03
**Ticket ID:** US-03.1
**Title:** Extract Tracking IDs from Script Content
**Priority:** P0
**Story Points:** 5
**Status:** Not Started
```

### Section 2: Description
Taken directly from epic EPIC.md file.

### Section 3: Acceptance Criteria
Taken directly from epic, converted to checkbox format.

### Section 4: Implementation Tasks
Detailed step-by-step tasks with time estimates.

### Section 5: Dependencies
- Blocking tickets
- Related tickets
- Epic dependencies

### Section 6: Testing Requirements
How to test this specific ticket.

### Section 7: Definition of Done
Completion checklist.

### Section 8: Related Tickets
Links to other US/TT in same or other epics.

---

## Command Reference

### Basic Usage
```bash
# Generate all missing tickets
/generate-tickets

# Generate for specific epic
/generate-tickets --epic=03

# Generate for multiple epics
/generate-tickets --epic=03 --epic=04
```

### Options
```bash
--epic=<number>    # Process specific epic (00-05) or "all"
--epic=all         # Process all epics (default)
--force            # Regenerate existing tickets
--validate-only    # Check without generating
--verbose          # Show detailed progress
```

### Examples
```bash
# Typical usage
/generate-tickets

# Regenerate everything from scratch
/generate-tickets --force

# Check before generating
/generate-tickets --validate-only

# Work on one epic at a time
/generate-tickets --epic=03
/generate-tickets --epic=04
/generate-tickets --epic=05
```

---

## Status Tracking

### Before Generation
```
| EPIC-03 | Conflict Detection | ⚠️ Pending README | 6 | 3 | ❌ Missing |
```

### After Generation
```
| EPIC-03 | Conflict Detection | ✅ Ready for Dev | 6 | 3 | ✅ Complete |
```

The status automatically updates when tickets are generated.

---

## Quality Assurance

The system validates all generated files:

```
✅ Markdown Syntax  - Valid markdown formatting
✅ Naming Convention - Proper kebab-case filenames
✅ Sections Present - All required sections included
✅ No Placeholders - No "TBD" or "TODO" text
✅ Acceptance Criteria - Specific, testable criteria
✅ Relative Links - Valid path references
✅ Content Completeness - All sections have content
```

If validation fails, files are not saved and errors are reported.

---

## Integration with Development

### Full Workflow

```
1. Plan Phase
   ↓
   /generate-tickets
   (Generate all tickets)
   ↓

2. Preparation Phase
   ↓
   /epic-status <number>
   (View available tickets)
   ↓

3. Development Phase
   ↓
   /work-epic <number>
   (Start working on tickets)
   ↓

4. Completion Phase
   ↓
   /epic-status <number>
   (Track progress)
   ↓
```

### With Individual Tickets
```bash
# See what tickets exist
/epic-status 03

# View specific ticket
cat docs/tickets/EPIC-03-conflict-detection/user-stories/us-03.1-extract-tracking-ids.md

# Use in PR/commit messages
git commit -m "feat(US-03.1): Extract GA4 and GTM tracking IDs"
```

---

## Customization

### Adding Custom Templates

The system uses built-in templates, but can be extended:

1. Create custom template file
2. Pass to command: `--template=custom`
3. Agent reads and uses custom template

(This is a future enhancement)

### Modifying Ticket Content

To modify generated tickets:

1. Edit the source EPIC.md file
2. Re-run: `/generate-tickets --epic=<number> --force`
3. Files are regenerated from source

---

## Troubleshooting

### Tickets Not Generated

**Problem:** Running `/generate-tickets` but no new files created

**Diagnosis:**
```bash
# Check if EPIC.md files exist
ls docs/tickets/EPIC-*/EPIC.md

# Check if tickets already exist
ls docs/tickets/EPIC-03-conflict-detection/user-stories/
```

**Solution:**
- If EPIC.md missing: Create it first
- If tickets exist: Use `--force` to regenerate
- Run with `--verbose` to see what happened

### Filename Errors

**Problem:** Generated filename doesn't match title

**Example:** Title "Auto-extract IDs" becomes `us-03.2-auto-extract-ids.md` but you expected different

**Solution:**
The kebab-case conversion follows these rules:
1. Lowercase everything
2. Replace spaces with hyphens
3. Remove special characters
4. Keep ticket ID prefix

If the result isn't what you want, edit the EPIC.md source title and regenerate with `--force`.

### Validation Failures

**Problem:** Files not generated due to validation errors

**Solution:** Run with `--verbose`:
```bash
/generate-tickets --verbose
```

This shows exactly which validation failed and why.

### Status Document Not Updated

**Problem:** EPIC-BREAKDOWN-STATUS.md didn't update

**Solution:**
1. Ensure file exists: `EPIC-BREAKDOWN-STATUS.md`
2. Check file permissions
3. Run with `--verbose` to see update attempt
4. Manually update if needed

---

## Performance

Expected timing:

| Operation | Time |
|-----------|------|
| Scan all epics | < 1 sec |
| Generate 1 epic | ~1.5 sec |
| Generate all 6 epics | ~8 sec |
| Quality validation | ~1 sec |
| Status update | < 1 sec |
| **Total** | **~12 seconds** |

---

## Related Files

- `.claude/commands/generate-tickets.md` - Command definition
- `.claude/agents/ticket-automation-agent.md` - Agent implementation
- `docs/development/ticket-system.md` - Ticket conventions
- `docs/development/ticket-examples.md` - Example tickets
- `EPIC-BREAKDOWN-STATUS.md` - Master status document

---

## Future Enhancements

Potential improvements to the automation system:

- [ ] Generate only specific ticket types (US or TT)
- [ ] Custom template support
- [ ] Export tickets to Jira/GitHub
- [ ] Automatic ticket assignment
- [ ] Parallel processing for speed
- [ ] Git integration (auto-commit)
- [ ] Slack notifications
- [ ] Email summaries

---

## FAQ

**Q: Can I manually edit generated tickets?**
A: Yes! Generated tickets can be edited like any markdown file. Run `--force` to regenerate from source if needed.

**Q: What if I modify EPIC.md?**
A: Re-run `/generate-tickets --force` to regenerate tickets with the new content.

**Q: Can I have different tickets than what's in EPIC.md?**
A: The automation generates from EPIC.md. Modify EPIC.md first, then regenerate.

**Q: How often should I run this?**
A: Typically once during setup, then as-needed when epics change.

**Q: Can it delete old tickets?**
A: No, it only creates new files. Use `--force` to regenerate without deleting.

**Q: What if two people run it at the same time?**
A: Safe! Each run is independent and atomic per epic.

---

## Version History

| Date | Version | Changes |
|------|---------|---------|
| 2025-10-16 | 1.0 | Initial automation system |

---

**Last Updated:** 2025-10-16
**Maintained By:** System
**Status:** Production Ready
