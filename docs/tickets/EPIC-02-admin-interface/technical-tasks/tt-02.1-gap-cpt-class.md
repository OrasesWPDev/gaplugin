# TT-02.1: Implement GAP_CPT Class

**Ticket ID:** TT-02.1
**Epic:** EPIC-02 (Custom Post Type & Admin Interface)
**Estimated Time:** 2 hours
**Status:** Not Started

---

## Overview

Create the GAP_CPT (Google Analytics Plugin - Custom Post Type) class that registers the "tracking_script" custom post type and implements custom admin columns.

---

## File Location

`includes/class-gap-cpt.php`

---

## Implementation Steps

1. Create class with singleton pattern
2. Define POST_TYPE constant
3. Implement register_post_type() method
4. Create get_labels() helper method
5. Implement add_custom_columns() filter
6. Implement render_custom_columns() action
7. Hook to WordPress init action

---

## Methods to Implement

### get_instance() - Singleton Pattern
- Static method
- Returns single instance of class
- Creates instance on first call
- Prevents multiple instantiations

### __construct() - Register Hooks
- Private constructor (singleton)
- Register 'init' hook to register_post_type()
- Register filter for manage_tracking_script_posts_columns
- Register action for manage_tracking_script_posts_custom_column

### register_post_type() - CPT Registration
- Call register_post_type() with configuration
- Use get_labels() for labels array
- Set capabilities to manage_options
- Set menu icon to dashicons-analytics
- Set supports to array('title')

### get_labels() - Helper Method
- Return array of all CPT labels
- Singular: "Tracking Script"
- Plural: "Tracking Scripts"
- Menu name: "Tracking Scripts"
- Add/edit/view labels

### add_custom_columns() - Column Headers
- Add Tracking IDs column
- Add Placement column
- Add Scope column
- Add Target Pages column
- Add Status column
- Remove date column if needed

### render_custom_columns() - Column Content
- Get post meta for each column
- Format and display values
- Use get_post_meta()
- Display "â€”" for empty fields

---

## CPT Configuration

```php
$args = array(
    'public'              => false,
    'publicly_queryable'  => false,
    'show_ui'             => true,
    'show_in_menu'        => true,
    'menu_position'       => 25,
    'menu_icon'           => 'dashicons-analytics',
    'capability_type'     => 'post',
    'capabilities'        => array(
        'edit_post'          => 'manage_options',
        'read_post'          => 'manage_options',
        'delete_post'        => 'manage_options',
        'edit_posts'         => 'manage_options',
        'edit_others_posts'  => 'manage_options',
        'delete_posts'       => 'manage_options',
        'publish_posts'      => 'manage_options',
        'read_private_posts' => 'manage_options',
    ),
    'supports'            => array('title'),
    'labels'              => $labels_array,
);
```

---

## Testing Requirements

### Visual Testing
- [ ] CPT appears in admin menu
- [ ] Menu icon displays correctly (analytics icon)
- [ ] Menu label shows "Tracking Scripts"
- [ ] Post list page loads correctly
- [ ] Add New button works

### Functionality Testing
- [ ] Only admin users can access (403 for non-admin)
- [ ] Admin users can create new posts
- [ ] Admin users can edit posts
- [ ] Admin users can delete posts
- [ ] Title field present, editor not present

### Custom Columns Testing
- [ ] All 5 custom columns display
- [ ] Tracking IDs column exists
- [ ] Placement column exists
- [ ] Scope column exists
- [ ] Target Pages column exists
- [ ] Status column exists

### Code Quality
- [ ] Singleton pattern properly implemented
- [ ] All methods documented with docblocks
- [ ] Following WordPress coding standards
- [ ] No PHP errors or warnings

---

## Success Criteria

- [ ] GAP_CPT class fully implemented
- [ ] Custom post type registered and visible
- [ ] Only admins can access tracking scripts
- [ ] Custom columns display on post list
- [ ] All methods properly documented
- [ ] No errors in WordPress debug log
- [ ] Code passes standards review

---

## Related Tickets

**Blocks:**
- US-02.1: Manage tracking scripts via CPT (depends on this)
- US-02.2: Custom admin columns

**Blocked By:**
- TT-01.x: Foundation setup (autoloader, initialization)

---

**Created:** 2025-10-16
**Expected Completion:** 2 hours
