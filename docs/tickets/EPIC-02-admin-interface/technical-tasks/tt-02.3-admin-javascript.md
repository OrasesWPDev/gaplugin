# TT-02.3: Create Admin JavaScript

**Ticket ID:** TT-02.3
**Epic:** EPIC-02 (Custom Post Type & Admin Interface)
**Estimated Time:** 1 hour
**Status:** Not Started

---

## Overview

Create admin.js file that implements dynamic UI interactions for the tracking script configuration form, specifically showing/hiding the page selector based on scope selection.

---

## File Location

`assets/js/admin.js`

---

## Implementation Steps

1. Create admin.js file
2. Wrap in document ready handler
3. Implement scope selector change handler
4. Show/hide page selector based on selection
5. Trigger initial state on page load
6. Test all interactions

---

## Script Structure

```javascript
/**
 * GA Plugin - Admin Interface JavaScript
 * Handles dynamic UI interactions for tracking script configuration
 */

(function($) {
    'use strict';

    $(document).ready(function() {
        // Only run on tracking_script post edit screen
        if (!$('body').hasClass('post-type-tracking_script')) {
            return;
        }

        initPageSelectorToggle();
    });

    /**
     * Toggle page selector visibility based on scope selection
     */
    function initPageSelectorToggle() {
        var $scopeSelect = $('#gap_scope');
        var $pageSelector = $('.gap-pages-selector');

        if (!$scopeSelect.length) {
            return;
        }

        // Handle scope selection change
        $scopeSelect.on('change', function() {
            if ($(this).val() === 'specific_pages') {
                $pageSelector.slideDown(200);
            } else {
                $pageSelector.slideUp(200);
            }
        });

        // Set initial state on page load
        $scopeSelect.trigger('change');
    }

})(jQuery);
```

---

## Features

### Show/Hide Logic
- Show page selector when scope = "specific_pages"
- Hide page selector when scope = "global"
- Use slideDown/slideUp for smooth animation

### Event Handling
- Bind to change event on scope dropdown
- Trigger change on page load for initial state
- Preserve user selections during toggle

### Page Detection
- Only run on tracking_script edit pages
- Check body class for post type
- Prevent errors on other pages

### jQuery Safety
- Use jQuery no-conflict mode: (function($) {...})(jQuery)
- Check for element existence before manipulation
- Proper error handling

---

## jQuery Methods Used

- `$(document).ready()` - Wait for DOM ready
- `$('body').hasClass()` - Check post type
- `$('#gap_scope')` - Get scope dropdown
- `$('.gap-pages-selector')` - Get page selector
- `.on('change')` - Bind change event
- `.val()` - Get selected value
- `.slideDown()` - Animate show
- `.slideUp()` - Animate hide
- `.trigger()` - Manually trigger event

---

## Testing Requirements

### Functionality
- [ ] Script loads only on tracking_script pages
- [ ] No errors in console
- [ ] Scope change triggers page selector toggle
- [ ] Page selector shows for "specific_pages"
- [ ] Page selector hides for "global"
- [ ] Initial state correct on page load
- [ ] Selected pages persist during toggle
- [ ] Script runs after validation errors

### Performance
- [ ] Animation is smooth (200ms)
- [ ] No lag or delays
- [ ] Fast DOM queries
- [ ] Minimal jQuery usage

### Cross-Browser
- [ ] Works in Chrome
- [ ] Works in Firefox
- [ ] Works in Safari
- [ ] Works in Edge
- [ ] Works in IE 11 (if supported)

### Responsive
- [ ] Works on desktop
- [ ] Works on tablet
- [ ] Works on mobile
- [ ] Touch events work (if applicable)

---

## Enqueue Location

Add to `includes/class-gap-meta-boxes.php`:

```php
public function enqueue_admin_scripts($hook) {
    if ('post.php' !== $hook && 'post-new.php' !== $hook) {
        return;
    }

    global $post_type;
    if ('tracking_script' !== $post_type) {
        return;
    }

    wp_enqueue_script(
        'gap-admin-js',
        GAP_PLUGIN_URL . 'assets/js/admin.js',
        array('jquery'),
        GAP_PLUGIN_VERSION,
        true
    );

    add_filter('admin_body_class', function($classes) {
        return $classes . ' post-type-tracking_script';
    });
}

add_action('admin_enqueue_scripts', array($this, 'enqueue_admin_scripts'), 10, 1);
```

---

## Success Criteria

- [ ] admin.js file created
- [ ] Script properly enqueued
- [ ] Page selector shows/hides correctly
- [ ] Animation smooth
- [ ] Initial state correct
- [ ] Works in all browsers
- [ ] No JavaScript errors
- [ ] Code review passed

---

## Related Tickets

**Blocks:**
- US-02.4: Dynamic UI (this is the implementation)

**Blocked By:**
- TT-02.2: Meta box rendering (page selector must exist)

---

**Created:** 2025-10-16
**Expected Completion:** 1 hour
**Complexity:** Low (straightforward jQuery)
