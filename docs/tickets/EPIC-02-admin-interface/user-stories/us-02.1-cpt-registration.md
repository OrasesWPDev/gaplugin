# US-02.1: Manage Tracking Scripts via Custom Post Type

**Ticket ID:** US-02.1
**Epic:** EPIC-02 (Custom Post Type & Admin Interface)
**Priority:** P0 (Critical)
**Story Points:** 5
**Status:** Not Started

---

## User Story

As an administrator, I need to manage tracking scripts via custom post type so that I have a centralized interface in WordPress admin for managing all tracking scripts.

---

## Acceptance Criteria

- [ ] Custom post type "tracking_script" is registered
- [ ] Post type appears in WordPress admin menu with proper label
- [ ] Menu displays analytics icon (dashicons-analytics)
- [ ] Menu label displays as "Tracking Scripts"
- [ ] Only users with manage_options capability can access
- [ ] Post type supports title field only (no editor)
- [ ] Post type is not publicly queryable
- [ ] Tracking scripts can be exported
- [ ] Admin can create new tracking scripts
- [ ] Admin can edit existing tracking scripts
- [ ] Admin can delete tracking scripts

---

## Implementation Tasks

| # | Task | Time Est | Status |
|---|------|----------|--------|
| 1 | Create GAP_CPT class skeleton with proper structure | 20 min | ⏳ |
| 2 | Implement register_post_type() method | 45 min | ⏳ |
| 3 | Define all CPT labels (singular, plural, menu name) | 30 min | ⏳ |
| 4 | Set all capabilities to manage_options | 15 min | ⏳ |
| 5 | Add dashicons-analytics icon configuration | 5 min | ⏳ |
| 6 | Hook registration to WordPress init action | 10 min | ⏳ |
| 7 | Test CPT appears in admin menu | 10 min | ⏳ |

**Total Estimated Time:** 135 minutes (2.25 hours)

---

## Technical Details

### CPT Configuration

```php
'public'              => false,
'publicly_queryable'  => false,
'show_ui'             => true,
'show_in_menu'        => true,
'menu_position'       => 25,
'menu_icon'           => 'dashicons-analytics',
'capability_type'     => 'post',
'capabilities'        => [
    'edit_post'          => 'manage_options',
    'read_post'          => 'manage_options',
    'delete_post'        => 'manage_options',
    'edit_posts'         => 'manage_options',
    'edit_others_posts'  => 'manage_options',
    'delete_posts'       => 'manage_options',
    'publish_posts'      => 'manage_options',
    'read_private_posts' => 'manage_options',
],
'supports'            => array('title'),
'labels'              => array(
    'name'               => 'Tracking Scripts',
    'singular_name'      => 'Tracking Script',
    'menu_name'          => 'Tracking Scripts',
    'add_new'            => 'Add New Tracking Script',
    'add_new_item'       => 'Add New Tracking Script',
    'edit_item'          => 'Edit Tracking Script',
    'new_item'           => 'New Tracking Script',
    'view_item'          => 'View Tracking Script',
    'search_items'       => 'Search Tracking Scripts',
    'not_found'          => 'No tracking scripts found',
    'not_found_in_trash' => 'No tracking scripts found in trash',
),
```

### Class Structure

```php
class GAP_CPT {
    const POST_TYPE = 'tracking_script';

    private static $instance = null;

    public static function get_instance() {
        if (null === self::$instance) {
            self::$instance = new self();
        }
        return self::$instance;
    }

    private function __construct() {
        add_action('init', array($this, 'register_post_type'));
        add_filter('manage_tracking_script_posts_columns', array($this, 'add_custom_columns'));
        add_action('manage_tracking_script_posts_custom_column', array($this, 'render_custom_columns'), 10, 2);
    }

    public function register_post_type() {
        // Implementation here
    }

    public function get_labels() {
        // Return labels array
    }

    public function add_custom_columns($columns) {
        // Add custom columns
    }

    public function render_custom_columns($column, $post_id) {
        // Render custom columns
    }
}
```

---

## Testing Checklist

### Manual Testing

- [ ] Activate plugin and verify no errors
- [ ] Check WordPress admin menu for "Tracking Scripts" entry
- [ ] Verify menu icon displays analytics icon
- [ ] Click menu item and verify post list page loads
- [ ] Click "Add New" button and verify new post screen loads
- [ ] Verify title field is present
- [ ] Verify editor field is NOT present
- [ ] Create test post and verify can save
- [ ] Try accessing post type as non-admin user (should fail)
- [ ] Try accessing post type as admin (should succeed)

### Code Quality

- [ ] Class follows WordPress coding standards
- [ ] All methods have proper docblocks
- [ ] Singleton pattern properly implemented
- [ ] Private constructor prevents direct instantiation
- [ ] All hooks properly registered

---

## Dependencies

**Upstream:**
- EPIC-01: Foundation (requires plugin initialization)

**Downstream:**
- US-02.2: Custom admin columns
- US-02.3: Meta boxes configuration
- TT-02.1: GAP_CPT class implementation

---

## Definition of Done

- [ ] GAP_CPT class created and properly structured
- [ ] register_post_type() method fully implemented
- [ ] All labels defined and translatable
- [ ] Capabilities set to manage_options only
- [ ] Menu icon displays correctly
- [ ] CPT hooks to init action
- [ ] All acceptance criteria passing
- [ ] Manual testing completed and documented
- [ ] Code follows WordPress standards
- [ ] Ready for US-02.2 (custom columns)

---

**File to Create:** `includes/class-gap-cpt.php`
**Related Files:** `ga-plugin.php` (main plugin file for initialization)

---

**Created:** 2025-10-16
**Last Updated:** 2025-10-16
**Estimated Completion:** ~2.25 hours from start
