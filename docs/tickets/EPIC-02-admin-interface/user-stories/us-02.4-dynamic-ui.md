# US-02.4: Dynamic UI for Better User Experience

**Ticket ID:** US-02.4
**Epic:** EPIC-02 (Custom Post Type & Admin Interface)
**Priority:** P1
**Story Points:** 3
**Status:** Not Started

---

## User Story

As an administrator, I need dynamic UI that shows/hides the page selector based on scope selection, so that the interface adapts to my choices without requiring a page reload.

---

## Acceptance Criteria

- [ ] Page selector is hidden by default (when scope = "global")
- [ ] Page selector shows when scope is changed to "specific_pages"
- [ ] Page selector hides when scope is changed back to "global"
- [ ] Transition between hidden/shown is smooth
- [ ] No page reload required for show/hide
- [ ] JavaScript loads only on tracking_script edit screen
- [ ] No JavaScript errors in browser console
- [ ] Works correctly after form validation errors
- [ ] Initial state is correct on page load
- [ ] User selections are preserved during show/hide

---

## Implementation Tasks

| # | Task | Time Est | Status |
|---|------|----------|--------|
| 1 | Create assets/js/admin.js file | 45 min | ⏳ |
| 2 | Implement scope selector change handler | 30 min | ⏳ |
| 3 | Implement show/hide page selector logic | 20 min | ⏳ |
| 4 | Enqueue script only on tracking_script pages | 20 min | ⏳ |
| 5 | Test all UI interactions | 15 min | ⏳ |

**Total Estimated Time:** 130 minutes (2.17 hours)

---

## JavaScript Implementation

### Script Structure
```javascript
jQuery(document).ready(function($) {
    // Show/hide page selector based on scope value
    $('#gap_scope').on('change', function() {
        if ($(this).val() === 'specific_pages') {
            $('.gap-pages-selector').slideDown();
        } else {
            $('.gap-pages-selector').slideUp();
        }
    }).trigger('change');  // Trigger on page load to set initial state
});
```

### Key Features

1. **Event Binding** - Listen for changes on scope dropdown
2. **Conditional Display** - Show/hide based on selected value
3. **Smooth Animation** - Use slideDown/slideUp for smooth transition
4. **Initial State** - Trigger change event on page load
5. **jQuery Safe** - Use jQuery no-conflict mode

---

## File Structure

**File:** `assets/js/admin.js`

```javascript
/**
 * GA Plugin - Admin Interface JavaScript
 *
 * Handles dynamic UI interactions for tracking script configuration
 */

(function($) {
    'use strict';

    $(document).ready(function() {
        // Only run on tracking_script post edit screen
        if (!$('body').hasClass('post-type-tracking_script')) {
            return;
        }

        // Initialize page selector visibility based on scope
        initPageSelectorToggle();
    });

    /**
     * Toggle page selector visibility based on scope selection
     */
    function initPageSelectorToggle() {
        var $scopeSelect = $('#gap_scope');
        var $pageSelector = $('.gap-pages-selector');

        if (!$scopeSelect.length) {
            return;  // Scope field not found
        }

        // Handle scope selection change
        $scopeSelect.on('change', function() {
            if ($(this).val() === 'specific_pages') {
                $pageSelector.slideDown(200);
            } else {
                $pageSelector.slideUp(200);
            }
        });

        // Set initial state on page load
        $scopeSelect.trigger('change');
    }

})(jQuery);
```

---

## Enqueue Location

Add to `includes/class-gap-meta-boxes.php`:

```php
/**
 * Enqueue admin JavaScript
 */
public function enqueue_admin_scripts($hook) {
    // Only enqueue on tracking_script edit pages
    if ('post.php' !== $hook && 'post-new.php' !== $hook) {
        return;
    }

    global $post_type;
    if ('tracking_script' !== $post_type) {
        return;
    }

    // Enqueue admin JavaScript
    wp_enqueue_script(
        'gap-admin-js',
        GAP_PLUGIN_URL . 'assets/js/admin.js',
        array('jquery'),
        GAP_PLUGIN_VERSION,
        true  // Load in footer
    );

    // Add body class for JavaScript detection
    add_filter('admin_body_class', function($classes) {
        return $classes . ' post-type-tracking_script';
    });
}

// Hook to admin_enqueue_scripts
add_action('admin_enqueue_scripts', array($this, 'enqueue_admin_scripts'), 10, 1);
```

---

## CSS for Page Selector

Add to `assets/css/admin.css`:

```css
/* Page selector container */
.gap-pages-selector {
    display: none;  /* Hidden by default */
    margin-top: 15px;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    background-color: #f9f9f9;
}

.gap-pages-selector.show {
    display: block;
}

/* Page selector checkboxes */
.gap-pages-selector label {
    display: block;
    margin: 8px 0;
    cursor: pointer;
}

.gap-pages-selector input[type="checkbox"] {
    margin-right: 8px;
    cursor: pointer;
}
```

---

## Testing Checklist

### Functionality Testing

- [ ] Navigate to new tracking script edit page
- [ ] Verify page selector is hidden initially
- [ ] Change scope from "global" to "specific_pages"
- [ ] Verify page selector slides down
- [ ] Change scope back to "global"
- [ ] Verify page selector slides up
- [ ] Repeat toggle multiple times
- [ ] Verify no page reloads occur

### User Data Persistence

- [ ] Select some pages in page selector
- [ ] Change scope to "global"
- [ ] Change scope back to "specific_pages"
- [ ] Verify previously selected pages are still selected
- [ ] Save post and reload
- [ ] Verify selections persisted

### Form Validation

- [ ] Fill all fields but leave scope empty
- [ ] Try to publish (should fail validation)
- [ ] Set scope to "specific_pages"
- [ ] Verify page selector appears despite validation error
- [ ] Fix validation error and publish
- [ ] Verify everything works correctly

### Browser Console

- [ ] Open browser developer tools (F12)
- [ ] Go to Console tab
- [ ] Navigate to tracking script edit page
- [ ] Verify no JavaScript errors
- [ ] Perform show/hide toggles
- [ ] Verify no errors in console

### Cross-Browser Testing

- [ ] Test in Chrome
- [ ] Test in Firefox
- [ ] Test in Safari
- [ ] Test in Edge
- [ ] Verify slideDown/slideUp works in all browsers

### Responsive Testing

- [ ] Test on desktop (1920px)
- [ ] Test on tablet (768px)
- [ ] Test on mobile (375px)
- [ ] Verify page selector displays correctly at all sizes
- [ ] Verify toggle functionality works on all sizes

---

## Dependencies

**Upstream:**
- US-02.3: Meta fields (page selector must exist)
- TT-02.2: GAP_Meta_Boxes class

**Downstream:**
- US-02.5: Admin styling (styles should not conflict with this JavaScript)

---

## Definition of Done

- [ ] JavaScript file created at correct location
- [ ] Script properly enqueued only on tracking_script pages
- [ ] Page selector shows/hides correctly based on scope
- [ ] Smooth animation (slideDown/slideUp)
- [ ] Initial state correct on page load
- [ ] User selections preserved during toggle
- [ ] No JavaScript errors in console
- [ ] Works in all major browsers
- [ ] Responsive on all screen sizes
- [ ] All acceptance criteria passing
- [ ] Code review passed
- [ ] Ready for deployment

---

**Files to Create:**
- `assets/js/admin.js`

**Files to Modify:**
- `includes/class-gap-meta-boxes.php` (add enqueue method)
- `assets/css/admin.css` (add page selector styles)

---

**Created:** 2025-10-16
**Last Updated:** 2025-10-16
**Complexity:** Low-Medium (straightforward JavaScript)
**Estimated Completion:** ~2.17 hours from start
