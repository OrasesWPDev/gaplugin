# US-03.1: Extract Tracking IDs from Script Content

**Ticket Type:** User Story
**Epic:** EPIC-03 Conflict Detection System
**Story Points:** 5
**Time Estimate:** 160 minutes

## Description

As a developer, I need to extract tracking IDs from script content so that the system can identify and track Google Analytics 4 (GA4) and Google Tag Manager (GTM) tracking codes.

This is a foundational capability for the conflict detection system. The extraction must be precise using regex patterns to correctly identify GA4 IDs (G-XXXXXXXXXX format) and GTM IDs (GTM-XXXXXXX format) from JavaScript code.

## Acceptance Criteria

- [ ] Regex pattern correctly matches GA4 IDs (G-XXXXXXXXXX)
- [ ] Regex pattern correctly matches GTM IDs (GTM-XXXXXXX)
- [ ] extract_tracking_ids() returns array of ID objects
- [ ] Each ID object contains: id, type, name
- [ ] Function handles multiple IDs in single script
- [ ] Function returns empty array if no IDs found

## Implementation Tasks

- [ ] Create GAP_Conflict_Detector class skeleton (20 min)
- [ ] Implement extract_tracking_ids() method (60 min)
- [ ] Write regex pattern for GA4 IDs (20 min)
- [ ] Write regex pattern for GTM IDs (20 min)
- [ ] Test with sample GA4 code (15 min)
- [ ] Test with sample GTM code (15 min)
- [ ] Test with mixed GA4+GTM code (10 min)

## Technical Details

### Regex Patterns

**GA4 Pattern:** `/['\"]G-[A-Z0-9]{10}['\""]/`
- Matches G-XXXXXXXXXX (10 alphanumeric characters)

**GTM Pattern:** `/['\"]GTM-[A-Z0-9]{7}['\""]/`
- Matches GTM-XXXXXXX (7 alphanumeric characters)

### Return Format

```php
[
    [
        'id' => 'G-ABC1234567',
        'type' => 'ga4',
        'name' => 'Google Analytics 4'
    ],
    [
        'id' => 'GTM-ABC1234',
        'type' => 'gtm',
        'name' => 'Google Tag Manager'
    ]
]
```

## Test Cases

### Test Case 1: GA4 ID Extraction
**Input:**
```javascript
gtag('config', 'G-ABC1234567');
```

**Expected Output:**
```php
[
    [
        'id' => 'G-ABC1234567',
        'type' => 'ga4',
        'name' => 'Google Analytics 4'
    ]
]
```

### Test Case 2: GTM ID Extraction
**Input:**
```javascript
'dataLayer','GTM-ABC1234'
```

**Expected Output:**
```php
[
    [
        'id' => 'GTM-ABC1234',
        'type' => 'gtm',
        'name' => 'Google Tag Manager'
    ]
]
```

### Test Case 3: Multiple IDs
**Input:**
```javascript
gtag('config', 'G-ABC1234567');
gtag('config', 'GTM-XYZ7890');
```

**Expected Output:**
```php
[
    [
        'id' => 'G-ABC1234567',
        'type' => 'ga4',
        'name' => 'Google Analytics 4'
    ],
    [
        'id' => 'GTM-XYZ7890',
        'type' => 'gtm',
        'name' => 'Google Tag Manager'
    ]
]
```

## Dependencies

- EPIC-01: Foundation (requires autoloader)

## Definition of Done

- [ ] Code complete and tested
- [ ] Meets WordPress coding standards
- [ ] All test cases passing
- [ ] Inline documentation complete
- [ ] PR review complete
- [ ] Ready to merge

## Notes

Generated: 2025-10-16

This is the foundation for the entire conflict detection system. Regex precision is critical to avoid false positives/negatives.
