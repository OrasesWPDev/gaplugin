# US-03.6: Conflict Logging for Debugging

**Ticket Type:** User Story
**Epic:** EPIC-03 Conflict Detection System
**Story Points:** 1
**Time Estimate:** 40 minutes

## Description

As a developer, I need conflict logging for debugging so that I can troubleshoot tracking script issues and understand when and why conflicts are detected without exposing technical details to site visitors.

This provides a debug trail in the WordPress error log when WP_DEBUG is enabled, helping developers diagnose duplicate tracking issues.

## Acceptance Criteria

- [ ] log_conflict() logs to WordPress debug log
- [ ] Only logs when WP_DEBUG is true
- [ ] Log messages prefixed with "GAP Conflict:"
- [ ] Logs include relevant context (script name, IDs)

## Implementation Tasks

- [ ] Implement log_conflict() method (20 min)
- [ ] Check WP_DEBUG constant (5 min)
- [ ] Use error_log() for logging (5 min)
- [ ] Test logging with WP_DEBUG enabled (10 min)

## Technical Details

### Method Implementation

```php
/**
 * Log conflict message to debug log
 *
 * @since 1.0.0
 * @param string $message The conflict message to log
 * @return void
 */
public function log_conflict($message) {
    if (defined('WP_DEBUG') && WP_DEBUG) {
        error_log('GAP Conflict: ' . $message);
    }
}
```

### Log Format

```
GAP Conflict: Duplicate tracking script detected for "Homepage GA4". IDs already on page: G-ABC1234567 (Google Analytics 4). Skipping output to prevent double-tracking.
```

## Test Cases

### Test Case 1: Log with WP_DEBUG Enabled
1. Enable WP_DEBUG in wp-config.php
2. Trigger a conflict (duplicate tracking ID)
3. Check debug.log file
4. Verify message appears with "GAP Conflict:" prefix
5. Verify includes script name and tracking ID

### Test Case 2: No Log with WP_DEBUG Disabled
1. Disable WP_DEBUG in wp-config.php
2. Trigger a conflict
3. Check debug.log file
4. Verify no new GAP Conflict messages appear

### Test Case 3: Multiple Conflicts
1. Enable WP_DEBUG
2. Create multiple conflicts
3. Check debug.log
4. Verify each conflict logged separately
5. Verify all include proper context

## Usage Examples

### Example 1: Frontend Duplicate Detection
```php
$detector = GAP_Conflict_Detector::get_instance();
$found_ids = $detector->scan_page_html($html, $extracted_ids);

if (!empty($found_ids)) {
    $id_list = implode(', ', array_column($found_ids, 'id'));
    $message = sprintf(
        'Duplicate tracking script detected for "%s". IDs already on page: %s. Skipping output to prevent double-tracking.',
        get_the_title($script->ID),
        $id_list
    );
    $detector->log_conflict($message);
}
```

### Example 2: Admin Conflict Detection
```php
$conflicts = $detector->check_global_conflicts();

if (!empty($conflicts)) {
    foreach ($conflicts as $conflict) {
        $post_titles = array_column($conflict['posts'], 'title');
        $message = sprintf(
            'Global conflict detected: %s (%s) used in multiple scripts: %s',
            $conflict['tracking_id'],
            $conflict['name'],
            implode(', ', $post_titles)
        );
        $detector->log_conflict($message);
    }
}
```

## Log File Location

- **Linux/Mac:** `wp-content/debug.log`
- **Windows:** `wp-content/debug.log`
- File created automatically when WP_DEBUG_LOG is true

### Enabling Debug Logging

Add to wp-config.php:
```php
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
define('WP_DEBUG_DISPLAY', false);
```

## Dependencies

- EPIC-01: Foundation

## Definition of Done

- [ ] Code complete and tested
- [ ] Meets WordPress coding standards
- [ ] All test cases passing
- [ ] Works with WP_DEBUG on/off
- [ ] Log messages clear and helpful
- [ ] PR review complete
- [ ] Ready to merge

## Notes

Generated: 2025-10-16

Debug logging is essential for troubleshooting but should never expose information to end users. Only active when WP_DEBUG is explicitly enabled.
