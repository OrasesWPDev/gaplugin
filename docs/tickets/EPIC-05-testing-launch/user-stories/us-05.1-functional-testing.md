# US-05.1: Comprehensive Functional Testing

**Ticket Type:** User Story
**Epic:** EPIC-05 Testing, Polish & Launch
**Story Points:** 8
**Time Estimate:** 360 minutes

## Description

As a QA tester, I need to verify all plugin functionality works correctly so that we can ensure a high-quality release with no critical bugs or functional issues.

This comprehensive testing covers activation/deactivation, CPT functionality, meta fields, frontend output, scope filtering, duplicate detection, and admin UI to validate the entire plugin works as specified.

## Acceptance Criteria

- [ ] Plugin activates without errors
- [ ] Can create, edit, delete tracking scripts
- [ ] All meta fields save correctly
- [ ] Scripts output in correct locations
- [ ] Scope filtering works (global vs. specific)
- [ ] Duplicate detection prevents double-tracking
- [ ] Admin warnings display for conflicts
- [ ] All admin columns display correct data

## Implementation Tasks

- [ ] Execute activation/deactivation tests (30 min)
- [ ] Execute CPT functionality tests (45 min)
- [ ] Execute meta field tests (60 min)
- [ ] Execute frontend output tests (60 min)
- [ ] Execute scope filtering tests (45 min)
- [ ] Execute duplicate detection tests (60 min)
- [ ] Execute admin UI tests (30 min)
- [ ] Document all test results (30 min)

## Test Scenarios

### Activation/Deactivation Tests

#### Test 1.1: Clean Installation
1. Fresh WordPress install (no other plugins)
2. Upload and activate GA Plugin
3. **Expected:** No PHP errors
4. **Expected:** "Tracking Scripts" menu appears
5. **Expected:** Database tables created (if any)

#### Test 1.2: Deactivation
1. Deactivate plugin
2. **Expected:** No PHP errors
3. **Expected:** Menu removed
4. **Expected:** Frontend scripts stop outputting

#### Test 1.3: Reactivation
1. Reactivate plugin
2. **Expected:** No errors
3. **Expected:** Previous settings preserved
4. **Expected:** Tracking scripts still exist

### CPT Functionality Tests

#### Test 2.1: Create New Script
1. Navigate to Tracking Scripts â†’ Add New
2. **Expected:** Add New page loads
3. **Expected:** Meta box displays
4. **Expected:** All fields visible

#### Test 2.2: Save Draft
1. Enter title "Test GA4 Script"
2. Click "Save Draft"
3. **Expected:** Post saves as draft
4. **Expected:** No errors
5. **Expected:** Appears in drafts list

#### Test 2.3: Publish Script
1. Open draft from Test 2.2
2. Click "Publish"
3. **Expected:** Post publishes
4. **Expected:** Appears in published list
5. **Expected:** Frontend output begins (if active)

#### Test 2.4: Edit Script
1. Open published script
2. Change title
3. Update
4. **Expected:** Changes save
5. **Expected:** Title updates in list

#### Test 2.5: Delete Script
1. Open any script
2. Move to Trash
3. **Expected:** Moves to trash
4. **Expected:** Removed from list
5. **Expected:** Frontend output stops

### Meta Field Tests

#### Test 3.1: Script Content
1. Create new script
2. Enter GA4 code in Script Content field
3. Save
4. Reopen script
5. **Expected:** Content persists exactly as entered

#### Test 3.2: Placement Field
1. Select each placement option:
   - head
   - body_top
   - body_bottom
   - footer
2. Save after each selection
3. Reopen and verify
4. **Expected:** Each selection persists

#### Test 3.3: Scope - Global
1. Select "Global (All Pages)"
2. Save
3. Reopen
4. **Expected:** Global selected
5. **Expected:** Target Pages hidden

#### Test 3.4: Scope - Specific Pages
1. Select "Specific Pages"
2. **Expected:** Target Pages selector appears
3. Select 2 pages
4. Save
5. Reopen
6. **Expected:** Specific Pages selected
7. **Expected:** 2 pages still selected

#### Test 3.5: Active Checkbox - Checked
1. Check "Active" checkbox
2. Save
3. Reopen
4. **Expected:** Checkbox still checked
5. **Expected:** Script outputs on frontend

#### Test 3.6: Active Checkbox - Unchecked
1. Uncheck "Active" checkbox
2. Save
3. Reopen
4. **Expected:** Checkbox still unchecked
5. **Expected:** Script does NOT output on frontend

### Frontend Output Tests

#### Test 4.1: Head Placement
1. Create script with head placement
2. Set active and global
3. Publish
4. Load frontend page
5. View page source
6. **Expected:** Script in `<head>` section
7. **Expected:** Between `<!-- GA Plugin: head -->` comments

#### Test 4.2: Body Top Placement
1. Create script with body_top placement
2. Set active and global
3. Publish
4. Load frontend page
5. View page source
6. **Expected:** Script after `<body>` tag
7. **Expected:** Before visible content

#### Test 4.3: Body Bottom Placement
1. Create script with body_bottom placement
2. Set active and global
3. Publish
4. Load frontend page
5. View page source
6. **Expected:** Script before `</body>` tag
7. **Expected:** After page content

#### Test 4.4: Footer Placement
1. Create script with footer placement
2. Set active and global
3. Publish
4. Load frontend page
5. View page source
6. **Expected:** Script at very end
7. **Expected:** After body_bottom scripts

#### Test 4.5: Script Execution
1. Create script with `console.log('GA Plugin Test')`
2. Set active and global
3. Load page in browser
4. Open developer console
5. **Expected:** Console shows "GA Plugin Test"
6. **Expected:** No JavaScript errors

#### Test 4.6: Multiple Placements
1. Create 4 scripts (one per placement)
2. All active and global
3. Load frontend page
4. View page source
5. **Expected:** All 4 scripts appear
6. **Expected:** Each in correct location
7. **Expected:** Correct order maintained

### Scope Filtering Tests

#### Test 5.1: Global Script on Multiple Pages
1. Create global script
2. Set active
3. Load homepage - **Expected:** Script appears
4. Load page - **Expected:** Script appears
5. Load post - **Expected:** Script appears
6. Load archive - **Expected:** Script appears

#### Test 5.2: Specific Page Script on Target Page
1. Create script with scope "Specific Pages"
2. Select "About" page as target
3. Set active
4. Load "About" page
5. **Expected:** Script appears

#### Test 5.3: Specific Page Script on Other Pages
1. Use script from Test 5.2 (target: About)
2. Load homepage
3. **Expected:** Script does NOT appear
4. Load "Contact" page
5. **Expected:** Script does NOT appear
6. Load blog archive
7. **Expected:** Script does NOT appear

### Duplicate Detection Tests

#### Test 6.1: Theme Has GA4 Script
1. Add GA4 script to theme header.php:
   ```php
   <script>gtag('config', 'G-ABC1234567');</script>
   ```
2. Create plugin script with same ID (G-ABC1234567)
3. Set active and global
4. Load page
5. View page source
6. **Expected:** Plugin script NOT output
7. **Expected:** HTML comment explains skip
8. Check debug.log (if WP_DEBUG enabled)
9. **Expected:** Conflict logged

#### Test 6.2: No Duplicates
1. Remove theme script from Test 6.1
2. Load page
3. **Expected:** Plugin script now outputs
4. **Expected:** No skip comment

#### Test 6.3: Admin Warning for Duplicate IDs
1. Create 2 scripts with same GA4 ID
2. Both published
3. Go to Tracking Scripts list
4. **Expected:** Admin error notice displays
5. **Expected:** Shows both script titles
6. **Expected:** Edit links functional

### Admin UI Tests

#### Test 7.1: Tracking IDs Column
1. Create script with GA4 code
2. Save
3. Go to Tracking Scripts list
4. **Expected:** Tracking IDs column shows G-XXXXXXXXXX
5. **Expected:** Shows "(Google Analytics 4)" label

#### Test 7.2: Placement Column
1. View Tracking Scripts list
2. **Expected:** Placement column shows value
3. **Expected:** Shows: head, body_top, body_bottom, or footer

#### Test 7.3: Scope Column
1. View Tracking Scripts list
2. **Expected:** Scope column shows value
3. **Expected:** Shows: Global or Specific Pages

#### Test 7.4: Status Column
1. View Tracking Scripts list
2. **Expected:** Status column shows Active or Inactive

#### Test 7.5: Scope Selector Dynamic UI
1. Edit script
2. Change scope to "Specific Pages"
3. **Expected:** Target Pages selector appears immediately
4. Change scope to "Global"
5. **Expected:** Target Pages selector hides immediately

## Test Results Documentation

### Results Template

```markdown
## Test Results - [Date]

### Environment
- WordPress Version: X.X.X
- PHP Version: X.X.X
- Theme: [Theme Name]
- Other Plugins: [List]

### Test Summary
- Total Tests: XX
- Passed: XX
- Failed: XX
- Blocked: XX

### Failed Tests
[List any failed tests with details]

### Bugs Found
[List any bugs discovered]

### Notes
[Any additional observations]
```

## Pass/Fail Criteria

### PASS Criteria
- All expected results achieved
- No PHP errors or warnings
- No JavaScript console errors
- Functionality works as specified

### FAIL Criteria
- Expected result not achieved
- PHP errors occur
- JavaScript errors occur
- Functionality doesn't work as specified

## Dependencies

- All previous EPICs must be complete
- EPIC-01: Foundation
- EPIC-02: Admin Interface
- EPIC-03: Conflict Detection
- EPIC-04: Frontend Output

## Definition of Done

- [ ] All test scenarios executed
- [ ] Results documented
- [ ] All critical tests passing
- [ ] Any bugs filed as separate tickets
- [ ] Sign-off from QA lead
- [ ] Ready for next phase

## Notes

Generated: 2025-10-16

This comprehensive functional test is critical before release. All major user flows and features must be validated to ensure quality.
